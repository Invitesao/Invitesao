<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invites - Sistema de Confirma√ß√£o de Presen√ßa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .animate-fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .mobile-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #e5e7eb; z-index: 50; }
        .mobile-container { padding-bottom: 80px; }
        @media (min-width: 768px) { .mobile-nav { display: none; } .mobile-container { padding-bottom: 0; } }
        .message-bubble { background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border-left: 4px solid #8b5cf6; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Mobile Navigation -->
    <div class="mobile-nav md:hidden">
        <div class="flex justify-around py-2">
            <button onclick="showSection('home')" class="flex flex-col items-center p-2 text-gray-600 hover:text-purple-600">
                <span class="text-xl">üè†</span><span class="text-xs">In√≠cio</span>
            </button>
            <div id="mobile-profile-nav" class="hidden">
                <button onclick="showSection('profile')" class="flex flex-col items-center p-2 text-gray-600 hover:text-purple-600">
                    <span class="text-xl">üë§</span><span class="text-xs">Perfil</span>
                </button>
            </div>
            <button onclick="showSection('about')" class="flex flex-col items-center p-2 text-gray-600 hover:text-purple-600">
                <span class="text-xl">‚ÑπÔ∏è</span><span class="text-xs">Sobre</span>
            </button>
            <div id="mobile-login-nav">
                <button onclick="showSection('login')" class="flex flex-col items-center p-2 text-gray-600 hover:text-purple-600">
                    <span class="text-xl">üîë</span><span class="text-xs">Login</span>
                </button>
            </div>
            <div id="mobile-user-nav" class="hidden">
                <button onclick="loadUserDashboard()" class="flex flex-col items-center p-2 text-gray-600 hover:text-purple-600">
                    <span class="text-xl">üìä</span><span class="text-xs">Painel</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Desktop Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-40 hidden md:block">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <h1 class="text-2xl font-bold text-purple-600">Invites</h1>
                <div class="flex space-x-6">
                    <a href="#" onclick="showSection('home')" class="text-gray-700 hover:text-purple-600">Menu</a>
                    <div id="user-profile-nav" class="hidden">
                        <a href="#" onclick="showSection('profile')" class="text-gray-700 hover:text-purple-600">Perfil</a>
                    </div>
                    <a href="#" onclick="showSection('about')" class="text-gray-700 hover:text-purple-600">Sobre N√≥s</a>
                </div>
                <div class="flex space-x-3">
                    <div id="user-info-nav" class="hidden flex items-center space-x-3">
                        <span class="text-gray-700">Ol√°, <span id="nav-username"></span></span>
                        <button onclick="loadUserDashboard()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">Painel</button>
                        <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">Sair</button>
                    </div>
                    <div id="login-nav" class="flex space-x-3">
                        <button onclick="showSection('login')" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">Login</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="mobile-container">
        <!-- Home Section -->
        <div id="home-section" class="section">
            <div class="md:hidden bg-white shadow-sm p-4 sticky top-0 z-30">
                <div class="flex justify-between items-center">
                    <h1 class="text-xl font-bold text-purple-600">Invites</h1>
                    <div id="mobile-user-info" class="hidden text-sm text-gray-600">
                        Ol√°, <span id="mobile-username"></span>
                    </div>
                </div>
            </div>

            <div class="gradient-bg text-white py-12 px-4">
                <div class="max-w-lg mx-auto text-center">
                    <h1 class="text-3xl md:text-5xl font-bold mb-4">Sistema de Confirma√ß√£o</h1>
                    <p class="text-lg md:text-xl mb-6">Crie p√°ginas personalizadas para seus eventos</p>
                    <button onclick="showSection('register')" class="w-full md:w-auto bg-white text-purple-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100">Criar Conta Gratuita</button>
                </div>
            </div>

            <div class="max-w-4xl mx-auto py-8 px-4">
                <div class="grid gap-6">
                    <div class="bg-white p-6 rounded-lg card-shadow text-center">
                        <div class="text-3xl mb-3">üéâ</div>
                        <h3 class="text-lg font-semibold mb-2">Eventos Personalizados</h3>
                        <p class="text-gray-600 text-sm">Crie p√°ginas √∫nicas para casamentos, anivers√°rios e outros eventos especiais</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg card-shadow text-center">
                        <div class="text-3xl mb-3">üì±</div>
                        <h3 class="text-lg font-semibold mb-2">Links Personalizados</h3>
                        <p class="text-gray-600 text-sm">Gere links espec√≠ficos com e sem acompanhantes para diferentes convidados</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg card-shadow text-center">
                        <div class="text-3xl mb-3">üìä</div>
                        <h3 class="text-lg font-semibold mb-2">Gest√£o Completa</h3>
                        <p class="text-gray-600 text-sm">Acompanhe confirma√ß√µes, mensagens e gerencie todos os aspectos do seu evento</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Section -->
        <div id="profile-section" class="section hidden">
            <div class="md:hidden bg-white shadow-sm p-4 sticky top-0 z-30">
                <h2 class="text-xl font-bold text-center">Meu Perfil</h2>
            </div>
            <div class="max-w-2xl mx-auto py-8 px-4">
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h2 class="text-2xl font-bold mb-6 hidden md:block">Meu Perfil</h2>
                    
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Nome Completo</label>
                                <input type="text" id="profile-full-name" class="w-full p-3 border rounded-lg" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Nome de Usu√°rio</label>
                                <input type="text" id="profile-username" class="w-full p-3 border rounded-lg bg-gray-50" readonly>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Senha Atual</label>
                            <div class="flex">
                                <input type="password" id="profile-password" class="flex-1 p-3 border rounded-l-lg bg-gray-50" readonly>
                                <button onclick="togglePasswordVisibility()" class="bg-gray-500 text-white px-4 py-3 rounded-r-lg hover:bg-gray-600" id="toggle-password-btn">üëÅÔ∏è</button>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="enableProfileEdit()" class="flex-1 bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700">Editar Perfil</button>
                            <button onclick="downloadUserReport()" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700">Baixar Relat√≥rio</button>
                        </div>
                        
                        <div id="profile-edit-form" class="hidden space-y-4 border-t pt-6">
                            <h3 class="text-lg font-semibold">Editar Informa√ß√µes</h3>
                            <div>
                                <label class="block text-sm font-medium mb-2">Novo Nome Completo</label>
                                <input type="text" id="edit-full-name" class="w-full p-3 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Nova Senha</label>
                                <input type="password" id="edit-password" class="w-full p-3 border rounded-lg">
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="saveProfileChanges()" class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">Salvar</button>
                                <button onclick="cancelProfileEdit()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Section -->
        <div id="about-section" class="section hidden">
            <div class="md:hidden bg-white shadow-sm p-4 sticky top-0 z-30">
                <h2 class="text-xl font-bold text-center">Sobre N√≥s</h2>
            </div>
            <div class="max-w-4xl mx-auto py-8 px-4">
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h2 class="text-2xl font-bold mb-4 hidden md:block">Sobre N√≥s</h2>
                    <p class="text-gray-700 mb-4">
                        O Invites √© uma plataforma inovadora que simplifica a organiza√ß√£o de eventos atrav√©s de um sistema inteligente de confirma√ß√£o de presen√ßa. Nossa miss√£o √© tornar a gest√£o de convidados mais eficiente e elegante.
                    </p>
                    <p class="text-gray-700">
                        Com anos de experi√™ncia em tecnologia e eventos, desenvolvemos uma solu√ß√£o completa que atende desde pequenas celebra√ß√µes at√© grandes eventos corporativos.
                    </p>
                </div>
            </div>
        </div>

        <!-- Register Section -->
        <div id="register-section" class="section hidden">
            <div class="md:hidden bg-white shadow-sm p-4 sticky top-0 z-30">
                <h2 class="text-xl font-bold text-center">Criar Conta</h2>
            </div>
            <div class="max-w-md mx-auto py-8 px-4">
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h2 class="text-2xl font-bold text-center mb-6 hidden md:block">Criar Nova Conta</h2>
                    <form id="register-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Nome Completo</label>
                            <input type="text" id="full-name" class="w-full p-3 border rounded-lg" placeholder="Seu nome completo" required>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Nome de Usu√°rio</label>
                                <input type="text" id="username" class="w-full p-3 border rounded-lg" placeholder="Seu usu√°rio" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Senha</label>
                                <input type="password" id="password" class="w-full p-3 border rounded-lg" placeholder="Sua senha" required>
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">Criar Conta</button>
                    </form>

                    <div id="account-created" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                        <h3 class="font-semibold text-green-800 mb-2">Conta Criada com Sucesso!</h3>
                        <p class="text-green-700 mb-3 text-sm">Sua solicita√ß√£o foi enviada para an√°lise. Entre em contacto com a Invites para receber seu token de acesso.</p>
                        <button onclick="showTokenSection()" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">Inserir Token</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Token Section -->
        <div id="token-section" class="section hidden">
            <div class="md:hidden bg-white shadow-sm p-4 sticky top-0 z-30">
                <h2 class="text-xl font-bold text-center">Token de Acesso</h2>
            </div>
            <div class="max-w-md mx-auto py-8 px-4">
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h2 class="text-2xl font-bold text-center mb-6 hidden md:block">Token de Acesso</h2>
                    
                    <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h3 class="font-semibold text-blue-800 mb-2">Como obter seu token?</h3>
                        <p class="text-blue-700 text-sm mb-2">1. Entre em contacto connosco via WhatsApp: <strong>+244 959 823 409</strong></p>
                        <p class="text-blue-700 text-sm mb-2">2. Informe o nome de usu√°rio: <strong id="pending-username"></strong></p>
                        <p class="text-blue-700 text-sm mb-2">3. Receba seu token √∫nico (formato: INV-XXXXXXXXXX)</p>
                        <p class="text-blue-700 text-sm">4. Insira o token abaixo para ativar sua conta</p>
                    </div>

                    <form id="token-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Token de Acesso</label>
                            <input type="text" id="access-token" class="w-full p-3 border rounded-lg" placeholder="INV-XXXXXXXXXX" required>
                        </div>
                        <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">Validar Token</button>
                    </form>

                    <div id="token-success" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                        <h3 class="font-semibold text-green-800 mb-2">Token Validado!</h3>
                        <p class="text-green-700 text-sm mb-3">Sua conta foi ativada com sucesso. Agora pode criar seus eventos.</p>
                        <button onclick="proceedToLogin()" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">Continuar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login Section -->
        <div id="login-section" class="section hidden">
            <div class="md:hidden bg-white shadow-sm p-4 sticky top-0 z-30">
                <h2 class="text-xl font-bold text-center">Login</h2>
            </div>
            <div class="max-w-md mx-auto py-8 px-4">
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h2 class="text-2xl font-bold text-center mb-6 hidden md:block">Login</h2>
                    <form id="login-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Nome de Usu√°rio</label>
                            <input type="text" id="login-username" class="w-full p-3 border rounded-lg" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Senha</label>
                            <input type="password" id="login-password" class="w-full p-3 border rounded-lg" required>
                        </div>
                        <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">Entrar</button>
                    </form>
                    <div class="mt-4 text-center">
                        <button onclick="showSection('register')" class="text-purple-600 text-sm hover:underline">N√£o tem conta? Criar agora</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Event Section -->
        <div id="create-event-section" class="section hidden">
            <div class="md:hidden bg-white shadow-sm p-4 sticky top-0 z-30">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold">Criar Evento</h2>
                    <button onclick="logout()" class="text-sm bg-red-100 px-3 py-1 rounded-full">Sair</button>
                </div>
            </div>
            <div class="max-w-2xl mx-auto py-8 px-4">
                <div class="bg-white rounded-lg p-6 card-shadow">
                    <h2 class="text-2xl font-bold text-center mb-6 hidden md:block">Criar Novo Evento</h2>
                    <form id="create-event-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Nome do Evento</label>
                            <input type="text" id="event-title" class="w-full p-3 border rounded-lg" placeholder="Ex: Casamento Jo√£o & Maria" required>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Descri√ß√£o do Evento (Opcional)</label>
                            <textarea id="event-description" rows="3" class="w-full p-3 border rounded-lg" placeholder="Descreva seu evento..."></textarea>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Data do Evento</label>
                                <input type="date" id="event-date" class="w-full p-3 border rounded-lg" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">Prazo para Confirma√ß√£o</label>
                                <input type="date" id="confirmation-deadline" class="w-full p-3 border rounded-lg">
                                <p class="text-xs text-gray-500 mt-1">Deixe vazio para n√£o definir prazo</p>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-2">Sistema de Presentes</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="gift-type" value="none" class="mr-2" checked>
                                    <span class="text-sm">N√£o usar sistema de presentes</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="gift-type" value="bank" class="mr-2">
                                    <span class="text-sm">Transfer√™ncia banc√°ria</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="gift-type" value="list" class="mr-2">
                                    <span class="text-sm">Lista de presentes</span>
                                </label>
                            </div>
                        </div>

                        <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">Criar Evento</button>
                    </form>

                    <div id="event-created" class="hidden mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                        <h3 class="font-semibold text-green-800 mb-2">Evento Criado!</h3>
                        <p class="text-green-700 mb-3 text-sm">Seu evento foi criado com sucesso. Acesse o painel para gerenciar.</p>
                        <button onclick="loadUserDashboard()" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">Ir para Painel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Dashboard -->
        <div id="user-dashboard" class="section hidden">
            <div class="bg-white shadow-sm p-4 sticky top-0 z-30">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold">Meus Eventos</h2>
                    <div class="flex space-x-2">
                        <button onclick="showSection('create-event')" class="bg-green-600 text-white px-3 py-1 rounded text-sm">+ Evento</button>
                        <button onclick="logout()" class="bg-red-600 text-white px-3 py-1 rounded text-sm">Sair</button>
                    </div>
                </div>
            </div>

            <div class="max-w-6xl mx-auto py-6 px-4">
                <div id="user-events-list" class="mb-6"></div>

                <div id="event-details" class="hidden">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-white p-4 rounded-lg card-shadow text-center">
                            <h3 class="text-sm font-semibold mb-1">Confirmados</h3>
                            <p class="text-2xl font-bold text-green-600" id="confirmed-count">0</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg card-shadow text-center">
                            <h3 class="text-sm font-semibold mb-1">Recusados</h3>
                            <p class="text-2xl font-bold text-red-600" id="declined-count">0</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg card-shadow text-center">
                            <h3 class="text-sm font-semibold mb-1">Total</h3>
                            <p class="text-2xl font-bold text-blue-600" id="total-rsvps">0</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg card-shadow text-center">
                            <h3 class="text-sm font-semibold mb-1">Acompanhantes</h3>
                            <p class="text-2xl font-bold text-purple-600" id="total-companions">0</p>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="bg-white rounded-lg p-4 card-shadow">
                            <h3 class="text-lg font-semibold mb-4">Links do Evento</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Link COM Acompanhante</label>
                                    <div class="flex">
                                        <input type="text" id="link-with-companion" class="flex-1 p-2 border rounded-l-lg bg-gray-50 text-xs" readonly>
                                        <button onclick="copyLink('link-with-companion')" class="bg-purple-600 text-white px-3 py-2 rounded-r-lg hover:bg-purple-700 text-xs">Copiar</button>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Link SEM Acompanhante</label>
                                    <div class="flex">
                                        <input type="text" id="link-without-companion" class="flex-1 p-2 border rounded-l-lg bg-gray-50 text-xs" readonly>
                                        <button onclick="copyLink('link-without-companion')" class="bg-purple-600 text-white px-3 py-2 rounded-r-lg hover:bg-purple-700 text-xs">Copiar</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg p-4 card-shadow">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">Sistema de Presentes</h3>
                                <label class="flex items-center">
                                    <input type="checkbox" id="enable-gifts" class="mr-2" onchange="toggleGiftSystem()">
                                    <span class="text-sm">Ativar Presentes</span>
                                </label>
                            </div>
                            
                            <div id="gift-system-config" class="hidden space-y-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Tipo de Sistema</label>
                                    <select id="gift-system-type" class="w-full p-2 border rounded-lg" onchange="toggleGiftType()">
                                        <option value="none">Desativado</option>
                                        <option value="bank">Transfer√™ncia Banc√°ria</option>
                                        <option value="list">Lista de Presentes</option>
                                    </select>
                                </div>

                                <div id="bank-config" class="hidden space-y-3">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Mensagem Personalizada</label>
                                        <textarea id="bank-message" rows="6" class="w-full p-2 border rounded-lg text-sm" placeholder="Digite sua mensagem...">Querido(a) convidado(a)!
Caso queira nos presentear, agradecemos
desde j√° o seu lindo gesto e gostar√≠amos
que o fizesse por transfer√™ncia banc√°ria.
para o IBAN indicado abaixo:

AO. 7210158
Titular Diogo dos santos Ingl√™s

Muito obrigado(a)!
Deus lhe aben√ßoe sempre!</textarea>
                                    </div>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">IBAN</label>
                                            <input type="text" id="bank-iban" class="w-full p-2 border rounded-lg text-sm" value="AO. 7210158">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Nome do Titular</label>
                                            <input type="text" id="bank-holder" class="w-full p-2 border rounded-lg text-sm" value="Diogo dos santos Ingl√™s">
                                        </div>
                                    </div>
                                </div>

                                <div id="list-config" class="hidden space-y-3">
                                    <div class="flex justify-between items-center">
                                        <label class="block text-sm font-medium">Lista de Presentes</label>
                                        <button onclick="addGiftItem()" class="bg-green-600 text-white px-3 py-1 rounded text-sm">+ Adicionar</button>
                                    </div>
                                    <div id="gift-items-list" class="space-y-2 max-h-40 overflow-y-auto"></div>
                                </div>

                                <button onclick="saveGiftSettings()" class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700">Salvar Configura√ß√µes</button>
                            </div>
                        </div>

                        <div id="message-wall" class="bg-white rounded-lg p-4 card-shadow">
                            <h3 class="text-lg font-semibold mb-4">Mural de Mensagens</h3>
                            <div id="messages-list" class="space-y-3 max-h-60 overflow-y-auto mb-4"></div>
                            <div class="text-center text-gray-500 text-sm" id="no-messages">
                                Nenhuma mensagem ainda. As mensagens dos convidados aparecer√£o aqui.
                            </div>
                        </div>

                        <div class="bg-white rounded-lg p-4 card-shadow">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold">Confirma√ß√µes Recentes</h3>
                                <button onclick="downloadEventReport()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 text-sm">üìÑ Relat√≥rio PDF</button>
                            </div>
                            <div id="recent-rsvps-list" class="space-y-3"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Guest RSVP Page -->
        <div id="guest-rsvp" class="section hidden">
            <div class="min-h-screen gradient-bg flex items-center justify-center px-4">
                <div class="max-w-lg w-full">
                    <div id="deadline-notice" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4 text-center hidden">
                        <p class="text-yellow-800 font-semibold">‚è∞ Por favor confirme sua presen√ßa at√©:</p>
                        <p class="text-yellow-700 text-lg font-bold" id="deadline-date"></p>
                    </div>

                    <div class="bg-white rounded-lg p-6 card-shadow">
                        <div class="text-center mb-6">
                            <h1 class="text-2xl md:text-3xl font-bold mb-2" id="rsvp-event-title">Evento</h1>
                            <p class="text-lg text-gray-600 mb-2" id="rsvp-event-date">Data</p>
                            <p class="text-sm text-gray-500" id="rsvp-event-description">Descri√ß√£o</p>
                        </div>
                        
                        <form id="rsvp-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Seu Nome Completo</label>
                                <input type="text" id="guest-name" class="w-full p-3 border rounded-lg" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">Confirma√ß√£o de Presen√ßa</label>
                                <select id="attendance-status" class="w-full p-3 border rounded-lg" required>
                                    <option value="">Selecione uma op√ß√£o</option>
                                    <option value="true">Confirmo minha presen√ßa</option>
                                    <option value="false">N√£o poderei comparecer</option>
                                </select>
                            </div>

                            <div id="companion-section" class="hidden">
                                <label class="block text-sm font-medium mb-2">Acompanhantes</label>
                                <div id="companion-inputs"></div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2">Mensagem (Opcional)</label>
                                <textarea id="guest-message" rows="3" class="w-full p-3 border rounded-lg" placeholder="Deixe uma mensagem carinhosa..."></textarea>
                            </div>

                            <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 font-semibold">Confirmar Presen√ßa</button>
                        </form>
                    </div>

                    <div id="gift-section" class="hidden bg-white rounded-lg p-6 card-shadow mt-4">
                        <div class="text-center mb-6">
                            <div class="text-3xl mb-3">üéÅ</div>
                            <h3 class="text-xl font-bold mb-2">Presentes</h3>
                            <p class="text-gray-600 text-sm">Se desejar nos presentear, escolha uma das op√ß√µes abaixo</p>
                        </div>

                        <div id="bank-gift-option" class="hidden">
                            <div class="bg-gray-50 p-4 rounded-lg mb-4">
                                <pre id="bank-gift-message" class="text-sm text-gray-700 whitespace-pre-wrap font-sans"></pre>
                            </div>
                            <div class="flex mb-4">
                                <input type="text" id="display-iban" class="flex-1 p-2 border rounded-l-lg bg-gray-50 text-sm" readonly>
                                <button onclick="copyIban()" class="bg-purple-600 text-white px-4 py-2 rounded-r-lg hover:bg-purple-700 text-sm">Copiar IBAN</button>
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="skipGifts()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">Ignorar</button>
                                <button onclick="confirmGiftChoice()" class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">Obrigado!</button>
                            </div>
                        </div>

                        <div id="list-gift-option" class="hidden">
                            <div class="space-y-3 mb-4 max-h-60 overflow-y-auto" id="available-gifts"></div>
                            <button onclick="skipGifts()" class="w-full bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">Ignorar Presentes</button>
                        </div>
                    </div>

                    <div id="guest-message-wall" class="hidden bg-white rounded-lg p-6 card-shadow mt-4">
                        <div class="text-center mb-4">
                            <div class="text-2xl mb-2">üí¨</div>
                            <h3 class="text-lg font-bold mb-2">Mural de Mensagens</h3>
                            <p class="text-gray-600 text-sm">Veja as mensagens carinhosas dos outros convidados</p>
                        </div>
                        <div id="guest-messages-list" class="space-y-3 max-h-60 overflow-y-auto"></div>
                    </div>

                    <div id="success-message" class="hidden bg-white rounded-lg p-6 card-shadow mt-4 text-center">
                        <div class="text-4xl mb-3">üéâ</div>
                        <h3 class="text-xl font-bold mb-2">Confirma√ß√£o Enviada!</h3>
                        <p class="text-gray-600">Obrigado por confirmar sua presen√ßa. Aguardamos voc√™ no evento!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-white py-6 text-center">
        <p class="text-sm">¬© 2025 Invites - Sistema de Confirma√ß√£o de Presen√ßa</p>
    </footer>

    <script>
        // Global variables
        let currentUser = null;
        let currentEvent = null;
        let users = JSON.parse(localStorage.getItem('invites_users') || '[]');
        let events = JSON.parse(localStorage.getItem('invites_events') || '[]');
        let rsvps = JSON.parse(localStorage.getItem('invites_rsvps') || '[]');
        let gifts = JSON.parse(localStorage.getItem('invites_gifts') || '[]');

        // Utility functions
        function saveData() {
            localStorage.setItem('invites_users', JSON.stringify(users));
            localStorage.setItem('invites_events', JSON.stringify(events));
            localStorage.setItem('invites_rsvps', JSON.stringify(rsvps));
            localStorage.setItem('invites_gifts', JSON.stringify(gifts));
        }

        function generateId() {
            return Date.now().toString() + Math.random().toString(36).substr(2, 9);
        }

        function generateToken() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let token = 'INV-';
            for (let i = 0; i < 12; i++) {
                token += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return token;
        }

        function generateCustomUrl(title) {
            return title.toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '')
                + '-' + Date.now().toString().slice(-6);
        }

        // Navigation functions
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            const targetSection = document.getElementById(sectionName + '-section') || 
                                 document.getElementById(sectionName + '-dashboard') ||
                                 document.getElementById(sectionName);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                targetSection.classList.add('animate-fade-in');
            }
            
            if (sectionName === 'profile' && currentUser) {
                loadUserProfile();
            }
        }

        // User session management
        function saveUserSession(user) {
            localStorage.setItem('current_user', JSON.stringify(user));
        }

        function loadUserSession() {
            const saved = localStorage.getItem('current_user');
            if (saved) {
                currentUser = JSON.parse(saved);
                updateUserInterface();
            }
        }

        function updateUserInterface() {
            if (currentUser) {
                document.getElementById('user-info-nav').classList.remove('hidden');
                document.getElementById('user-profile-nav').classList.remove('hidden');
                document.getElementById('mobile-profile-nav').classList.remove('hidden');
                document.getElementById('mobile-user-nav').classList.remove('hidden');
                document.getElementById('mobile-user-info').classList.remove('hidden');
                
                document.getElementById('login-nav').classList.add('hidden');
                document.getElementById('mobile-login-nav').classList.add('hidden');
                
                document.getElementById('nav-username').textContent = currentUser.username;
                document.getElementById('mobile-username').textContent = currentUser.username;
            } else {
                document.getElementById('user-info-nav').classList.add('hidden');
                document.getElementById('user-profile-nav').classList.add('hidden');
                document.getElementById('mobile-profile-nav').classList.add('hidden');
                document.getElementById('mobile-user-nav').classList.add('hidden');
                document.getElementById('mobile-user-info').classList.add('hidden');
                
                document.getElementById('login-nav').classList.remove('hidden');
                document.getElementById('mobile-login-nav').classList.remove('hidden');
            }
        }

        function logout() {
            currentUser = null;
            currentEvent = null;
            localStorage.removeItem('current_user');
            updateUserInterface();
            showSection('home');
        }

        // Profile functions
        function loadUserProfile() {
            if (!currentUser) return;
            
            document.getElementById('profile-full-name').value = currentUser.full_name || '';
            document.getElementById('profile-username').value = currentUser.username || '';
            document.getElementById('profile-password').value = currentUser.password || '';
        }

        function togglePasswordVisibility() {
            const passwordField = document.getElementById('profile-password');
            const toggleBtn = document.getElementById('toggle-password-btn');
            
            if (passwordField.type === 'password') {
                passwordField.type = 'text';
                toggleBtn.textContent = 'üôà';
            } else {
                passwordField.type = 'password';
                toggleBtn.textContent = 'üëÅÔ∏è';
            }
        }

        function enableProfileEdit() {
            document.getElementById('profile-edit-form').classList.remove('hidden');
            document.getElementById('edit-full-name').value = currentUser.full_name || '';
            document.getElementById('edit-password').value = '';
        }

        function cancelProfileEdit() {
            document.getElementById('profile-edit-form').classList.add('hidden');
        }

        function saveProfileChanges() {
            const newFullName = document.getElementById('edit-full-name').value.trim();
            const newPassword = document.getElementById('edit-password').value.trim();
            
            if (!newFullName) {
                alert('Nome completo √© obrigat√≥rio');
                return;
            }
            
            currentUser.full_name = newFullName;
            if (newPassword) {
                currentUser.password = newPassword;
            }
            
            // Update in users array
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                saveData();
            }
            
            saveUserSession(currentUser);
            updateUserInterface();
            loadUserProfile();
            cancelProfileEdit();
            
            alert('Perfil atualizado com sucesso!');
        }

        // Token functions
        function showTokenSection() {
            showSection('token');
            const pendingUsername = localStorage.getItem('pending_username');
            if (pendingUsername) {
                document.getElementById('pending-username').textContent = pendingUsername;
            }
        }

        function proceedToLogin() {
            if (currentUser) {
                updateUserInterface();
                loadUserDashboard();
            } else {
                showSection('login');
            }
        }

        // Form handlers
        document.getElementById('register-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const fullName = document.getElementById('full-name').value;
            const password = document.getElementById('password').value;
            
            // Check if username exists
            if (users.find(u => u.username === username)) {
                alert('Nome de usu√°rio j√° existe');
                return;
            }
            
            const token = generateToken();
            const newUser = {
                id: generateId(),
                username: username,
                full_name: fullName,
                password: password,
                token: token,
                is_active: false,
                created_at: new Date().toISOString()
            };
            
            users.push(newUser);
            saveData();
            
            localStorage.setItem('pending_username', username);
            localStorage.setItem('pending_user_id', newUser.id);
            
            document.getElementById('pending-username').textContent = username;
            document.getElementById('account-created').classList.remove('hidden');
            this.reset();
        });

        document.getElementById('token-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const enteredToken = document.getElementById('access-token').value.trim();
            const pendingUserId = localStorage.getItem('pending_user_id');
            
            const user = users.find(u => u.id === pendingUserId);
            if (!user || user.token !== enteredToken) {
                alert('Token inv√°lido');
                return;
            }
            
            user.is_active = true;
            user.last_login = new Date().toISOString();
            saveData();
            
            currentUser = user;
            saveUserSession(user);
            updateUserInterface();
            
            document.getElementById('token-success').classList.remove('hidden');
            
            localStorage.removeItem('pending_username');
            localStorage.removeItem('pending_user_id');
        });

        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            const user = users.find(u => u.username === username && u.password === password);
            if (!user) {
                alert('Credenciais inv√°lidas');
                return;
            }
            
            if (!user.is_active) {
                localStorage.setItem('pending_username', username);
                localStorage.setItem('pending_user_id', user.id);
                document.getElementById('pending-username').textContent = username;
                showTokenSection();
                return;
            }
            
            user.last_login = new Date().toISOString();
            saveData();
            
            currentUser = user;
            saveUserSession(user);
            updateUserInterface();
            loadUserDashboard();
        });

        document.getElementById('create-event-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const eventTitle = document.getElementById('event-title').value;
            const customUrl = generateCustomUrl(eventTitle);
            const giftType = document.querySelector('input[name="gift-type"]:checked').value;
            
            let giftConfig = null;
            let enableGifts = false;

            if (giftType === 'bank') {
                enableGifts = true;
                giftConfig = {
                    type: 'bank',
                    message: 'Querido(a) convidado(a)!\nCaso queira nos presentear, agradecemos\ndesde j√° o seu lindo gesto e gostar√≠amos\nque o fizesse por transfer√™ncia banc√°ria.\npara o IBAN indicado abaixo:\n\nAO. 7210158\nTitular Diogo dos santos Ingl√™s\n\nMuito obrigado(a)!\nDeus lhe aben√ßoe sempre!',
                    iban: 'AO. 7210158',
                    holder: 'Diogo dos santos Ingl√™s'
                };
            } else if (giftType === 'list') {
                enableGifts = true;
                giftConfig = { type: 'list', items: [] };
            }

            const newEvent = {
                id: generateId(),
                user_id: currentUser.id,
                title: eventTitle,
                description: document.getElementById('event-description').value || null,
                event_date: document.getElementById('event-date').value,
                confirmation_deadline: document.getElementById('confirmation-deadline').value || null,
                custom_url: customUrl,
                enable_gifts: enableGifts,
                gift_config: giftConfig,
                created_at: new Date().toISOString()
            };
            
            events.push(newEvent);
            saveData();
            
            currentEvent = newEvent;
            document.getElementById('event-created').classList.remove('hidden');
            this.reset();
        });

        // Dashboard functions
        function loadUserDashboard() {
            showSection('user-dashboard');
            
            const userEvents = events.filter(e => e.user_id === currentUser.id);
            const container = document.getElementById('user-events-list');
            container.innerHTML = '';
            
            if (userEvents.length === 0) {
                container.innerHTML = `
                    <div class="bg-white rounded-lg p-6 card-shadow text-center">
                        <div class="text-4xl mb-3">üéâ</div>
                        <h3 class="text-lg font-semibold mb-2">Nenhum evento criado</h3>
                        <p class="text-gray-600 mb-4">Crie seu primeiro evento para come√ßar a receber confirma√ß√µes!</p>
                        <button onclick="showSection('create-event')" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">Criar Primeiro Evento</button>
                    </div>
                `;
                return;
            }
            
            userEvents.forEach(event => {
                const eventRsvps = rsvps.filter(r => r.wedding_id === event.id);
                const confirmed = eventRsvps.filter(r => r.attendance === true).length;
                const total = eventRsvps.length;
                
                const div = document.createElement('div');
                div.className = 'bg-white rounded-lg p-4 card-shadow mb-4 cursor-pointer hover:shadow-lg transition-shadow';
                div.onclick = () => selectEvent(event);
                
                const eventDate = new Date(event.event_date);
                const isUpcoming = eventDate > new Date();
                
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold mb-1">${event.title}</h3>
                            <p class="text-sm text-gray-600 mb-2">${eventDate.toLocaleDateString('pt-BR')}</p>
                            ${event.description ? `<p class="text-xs text-gray-500 mb-2">${event.description}</p>` : ''}
                            <div class="flex items-center space-x-4 text-xs">
                                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded">ID: ${event.custom_url}</span>
                                <span class="${isUpcoming ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'} px-2 py-1 rounded">
                                    ${isUpcoming ? 'Ativo' : 'Finalizado'}
                                </span>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-semibold text-purple-600">${confirmed}/${total}</p>
                            <p class="text-xs text-gray-500">confirma√ß√µes</p>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function selectEvent(event) {
            currentEvent = event;
            
            document.getElementById('user-events-list').style.display = 'none';
            document.getElementById('event-details').classList.remove('hidden');
            
            const baseUrl = window.location.origin + window.location.pathname;
            document.getElementById('link-with-companion').value = `${baseUrl}?event=${currentEvent.custom_url}&companion=true`;
            document.getElementById('link-without-companion').value = `${baseUrl}?event=${currentEvent.custom_url}&companion=false`;
            
            document.getElementById('enable-gifts').checked = currentEvent.enable_gifts || false;
            
            loadGiftConfiguration();
            updateUserStats();
            loadRecentRSVPs();
            loadMessageWall();
            
            const backButton = document.createElement('button');
            backButton.className = 'mb-4 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600';
            backButton.textContent = '‚Üê Voltar aos Eventos';
            backButton.onclick = () => {
                document.getElementById('user-events-list').style.display = 'block';
                document.getElementById('event-details').classList.add('hidden');
                currentEvent = null;
            };
            
            const eventDetails = document.getElementById('event-details');
            if (!eventDetails.querySelector('button')) {
                eventDetails.insertBefore(backButton, eventDetails.firstChild);
            }
        }

        function updateUserStats() {
            const eventRsvps = rsvps.filter(r => r.wedding_id === currentEvent.id);
            const confirmed = eventRsvps.filter(r => r.attendance === true).length;
            const declined = eventRsvps.filter(r => r.attendance === false).length;
            const companions = eventRsvps.filter(r => r.companion_name).length;
            
            document.getElementById('confirmed-count').textContent = confirmed;
            document.getElementById('declined-count').textContent = declined;
            document.getElementById('total-rsvps').textContent = eventRsvps.length;
            document.getElementById('total-companions').textContent = companions;
        }

        function loadRecentRSVPs() {
            const eventRsvps = rsvps.filter(r => r.wedding_id === currentEvent.id)
                .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
                .slice(0, 5);
            
            const container = document.getElementById('recent-rsvps-list');
            container.innerHTML = '';
            
            eventRsvps.forEach(rsvp => {
                const div = document.createElement('div');
                div.className = 'p-3 border rounded-lg';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-semibold text-sm">${rsvp.guest_name}</p>
                            ${rsvp.companion_name ? `<p class="text-xs text-gray-600">+ ${rsvp.companion_name}</p>` : ''}
                            ${rsvp.message ? `<p class="text-xs text-gray-500 mt-1">"${rsvp.message}"</p>` : ''}
                        </div>
                        <span class="text-xs px-2 py-1 rounded ${rsvp.attendance ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                            ${rsvp.attendance ? 'Confirmado' : 'Recusado'}
                        </span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function loadMessageWall() {
            const eventRsvps = rsvps.filter(r => r.wedding_id === currentEvent.id && r.message)
                .sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
            
            const container = document.getElementById('messages-list');
            const noMessages = document.getElementById('no-messages');
            
            if (eventRsvps.length === 0) {
                container.innerHTML = '';
                noMessages.style.display = 'block';
                return;
            }
            
            noMessages.style.display = 'none';
            container.innerHTML = '';
            
            eventRsvps.forEach(rsvp => {
                const div = document.createElement('div');
                div.className = 'message-bubble p-3 rounded-lg';
                
                const hasCompanions = rsvp.companion_name && rsvp.companion_name.trim();
                const isPlural = hasCompanions;
                
                let guestInfo = rsvp.guest_name;
                if (hasCompanions) {
                    const companions = rsvp.companion_name.split(',').map(c => c.trim());
                    guestInfo += ` e ${companions.join(', ')}`;
                }
                
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-semibold text-sm text-purple-700">${guestInfo}</span>
                        <span class="text-xs text-gray-500">${new Date(rsvp.created_at).toLocaleDateString('pt-BR')}</span>
                    </div>
                    <p class="text-sm text-gray-700">${rsvp.message}</p>
                    <div class="mt-2 text-xs text-gray-500">
                        ${rsvp.attendance ? 
                            (isPlural ? 'Confirmaram presen√ßa' : 'Confirmou presen√ßa') : 
                            (isPlural ? 'N√£o comparecer√£o' : 'N√£o comparecer√°')
                        }
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function copyLink(inputId) {
            const input = document.getElementById(inputId);
            input.select();
            input.setSelectionRange(0, 99999);
            document.execCommand('copy');
            
            const button = input.nextElementSibling;
            const originalText = button.textContent;
            button.textContent = 'Copiado!';
            button.classList.add('bg-green-600');
            button.classList.remove('bg-purple-600');
            
            setTimeout(() => {
                button.textContent = originalText;
                button.classList.remove('bg-green-600');
                button.classList.add('bg-purple-600');
            }, 2000);
        }

        // Gift system functions
        function toggleGiftSystem() {
            const enabled = document.getElementById('enable-gifts').checked;
            const configSection = document.getElementById('gift-system-config');
            
            if (enabled) {
                configSection.classList.remove('hidden');
            } else {
                configSection.classList.add('hidden');
            }
        }

        function toggleGiftType() {
            const type = document.getElementById('gift-system-type').value;
            document.getElementById('bank-config').classList.add('hidden');
            document.getElementById('list-config').classList.add('hidden');
            
            if (type === 'bank') {
                document.getElementById('bank-config').classList.remove('hidden');
            } else if (type === 'list') {
                document.getElementById('list-config').classList.remove('hidden');
                loadGiftItems();
            }
        }

        function loadGiftConfiguration() {
            const giftConfig = currentEvent.gift_config;
            if (!giftConfig) {
                document.getElementById('gift-system-type').value = 'none';
                return;
            }

            document.getElementById('gift-system-type').value = giftConfig.type;
            
            if (giftConfig.type === 'bank') {
                document.getElementById('bank-config').classList.remove('hidden');
                document.getElementById('bank-message').value = giftConfig.message || '';
                document.getElementById('bank-iban').value = giftConfig.iban || '';
                document.getElementById('bank-holder').value = giftConfig.holder || '';
            } else if (giftConfig.type === 'list') {
                document.getElementById('list-config').classList.remove('hidden');
                loadGiftItems();
            }
        }

        function loadGiftItems() {
            const container = document.getElementById('gift-items-list');
            container.innerHTML = '';
            
            const giftConfig = currentEvent.gift_config;
            if (!giftConfig || !giftConfig.items) return;
            
            giftConfig.items.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-2 p-2 border rounded-lg';
                div.innerHTML = `
                    <input type="text" value="${item.name}" class="flex-1 p-1 border rounded text-sm" onchange="updateGiftItem(${index}, 'name', this.value)">
                    <input type="number" value="${item.quantity}" class="w-16 p-1 border rounded text-sm" min="1" onchange="updateGiftItem(${index}, 'quantity', this.value)">
                    <button onclick="removeGiftItem(${index})" class="bg-red-500 text-white px-2 py-1 rounded text-xs">√ó</button>
                `;
                container.appendChild(div);
            });
        }

        function addGiftItem() {
            if (!currentEvent.gift_config) {
                currentEvent.gift_config = { type: 'list', items: [] };
            }
            if (!currentEvent.gift_config.items) {
                currentEvent.gift_config.items = [];
            }
            
            currentEvent.gift_config.items.push({ name: 'Novo presente', quantity: 1 });
            loadGiftItems();
        }

        function updateGiftItem(index, field, value) {
            if (field === 'quantity') {
                value = parseInt(value) || 1;
            }
            currentEvent.gift_config.items[index][field] = value;
        }

        function removeGiftItem(index) {
            currentEvent.gift_config.items.splice(index, 1);
            loadGiftItems();
        }

        function saveGiftSettings() {
            const type = document.getElementById('gift-system-type').value;
            let giftConfig = null;
            
            if (type === 'bank') {
                giftConfig = {
                    type: 'bank',
                    message: document.getElementById('bank-message').value,
                    iban: document.getElementById('bank-iban').value,
                    holder: document.getElementById('bank-holder').value
                };
            } else if (type === 'list') {
                giftConfig = currentEvent.gift_config;
            }
            
            currentEvent.enable_gifts = type !== 'none';
            currentEvent.gift_config = giftConfig;
            
            // Update in events array
            const eventIndex = events.findIndex(e => e.id === currentEvent.id);
            if (eventIndex !== -1) {
                events[eventIndex] = currentEvent;
                saveData();
            }
            
            alert('Configura√ß√µes de presentes salvas com sucesso!');
        }

        // Report functions
        function downloadUserReport() {
            if (!currentUser) return;
            
            const userEvents = events.filter(e => e.user_id === currentUser.id);
            const allRsvps = rsvps.filter(r => userEvents.some(e => e.id === r.wedding_id));
            
            generateUserPDFReport(currentUser, userEvents, allRsvps);
        }

        function downloadEventReport() {
            if (!currentEvent) return;
            
            const eventRsvps = rsvps.filter(r => r.wedding_id === currentEvent.id);
            const eventGifts = gifts.filter(g => g.event_id === currentEvent.id);
            
            generateEventPDFReport(currentEvent, eventRsvps, eventGifts);
        }

        function generateUserPDFReport(user, events, rsvps) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('Relat√≥rio do Usu√°rio - Invites', 20, 20);
            
            doc.setFontSize(12);
            doc.text(`Nome: ${user.full_name}`, 20, 35);
            doc.text(`Usu√°rio: ${user.username}`, 20, 45);
            doc.text(`Membro desde: ${new Date(user.created_at).toLocaleDateString('pt-BR')}`, 20, 55);
            doc.text(`Relat√≥rio gerado em: ${new Date().toLocaleDateString('pt-BR')}`, 20, 65);
            
            let yPos = 80;
            
            doc.setFontSize(16);
            doc.text('Resumo dos Eventos', 20, yPos);
            yPos += 15;
            
            doc.setFontSize(12);
            doc.text(`Total de eventos criados: ${events.length}`, 20, yPos);
            yPos += 10;
            
            const totalRsvps = rsvps.length;
            const confirmedRsvps = rsvps.filter(r => r.attendance === true).length;
            
            doc.text(`Total de confirma√ß√µes recebidas: ${totalRsvps}`, 20, yPos);
            yPos += 10;
            doc.text(`Confirma√ß√µes positivas: ${confirmedRsvps}`, 20, yPos);
            yPos += 20;
            
            if (events.length > 0) {
                doc.setFontSize(16);
                doc.text('Detalhes dos Eventos', 20, yPos);
                yPos += 15;
                
                events.forEach((event, index) => {
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 20;
                    }
                    
                    doc.setFontSize(14);
                    doc.text(`${index + 1}. ${event.title}`, 20, yPos);
                    yPos += 10;
                    
                    doc.setFontSize(10);
                    doc.text(`Data: ${new Date(event.event_date).toLocaleDateString('pt-BR')}`, 25, yPos);
                    yPos += 8;
                    
                    const eventRsvps = rsvps.filter(r => r.wedding_id === event.id);
                    const eventConfirmed = eventRsvps.filter(r => r.attendance === true).length;
                    
                    doc.text(`Confirma√ß√µes: ${eventConfirmed} (${eventRsvps.length} total)`, 25, yPos);
                    yPos += 15;
                });
            }
            
            doc.save(`relatorio-usuario-${user.username}-${new Date().toISOString().split('T')[0]}.pdf`);
        }

        function generateEventPDFReport(event, rsvps, gifts) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('Relat√≥rio do Evento - Invites', 20, 20);
            
            doc.setFontSize(16);
            doc.text(event.title, 20, 35);
            
            doc.setFontSize(12);
            doc.text(`Data do evento: ${new Date(event.event_date).toLocaleDateString('pt-BR')}`, 20, 50);
            doc.text(`Relat√≥rio gerado em: ${new Date().toLocaleDateString('pt-BR')}`, 20, 60);
            
            let yPos = 75;
            
            const confirmed = rsvps.filter(r => r.attendance === true);
            const declined = rsvps.filter(r => r.attendance === false);
            
            doc.setFontSize(16);
            doc.text('Estat√≠sticas', 20, yPos);
            yPos += 15;
            
            doc.setFontSize(12);
            doc.text(`Total de confirma√ß√µes: ${rsvps.length}`, 20, yPos);
            yPos += 10;
            doc.text(`Confirmaram presen√ßa: ${confirmed.length}`, 20, yPos);
            yPos += 10;
            doc.text(`N√£o comparecer√£o: ${declined.length}`, 20, yPos);
            yPos += 20;
            
            if (confirmed.length > 0) {
                doc.setFontSize(16);
                doc.text('Lista de Confirmados', 20, yPos);
                yPos += 15;
                
                confirmed.forEach((rsvp, index) => {
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 20;
                    }
                    
                    doc.setFontSize(12);
                    let guestText = `${index + 1}. ${rsvp.guest_name}`;
                    
                    if (rsvp.companion_name) {
                        guestText += ` + ${rsvp.companion_name}`;
                    }
                    
                    doc.text(guestText, 20, yPos);
                    yPos += 10;
                });
            }
            
            const eventName = event.title.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
            doc.save(`relatorio-evento-${eventName}-${new Date().toISOString().split('T')[0]}.pdf`);
        }

        // Guest RSVP functions
        function loadGuestRSVP() {
            const urlParams = new URLSearchParams(window.location.search);
            const eventUrl = urlParams.get('event');
            const allowCompanion = urlParams.get('companion') === 'true';
            
            if (!eventUrl) return;
            
            const event = events.find(e => e.custom_url === eventUrl);
            if (!event) {
                alert('Evento n√£o encontrado');
                return;
            }
            
            window.currentEventData = event;
            window.allowCompanion = allowCompanion;
            
            showSection('guest-rsvp');
            
            document.getElementById('rsvp-event-title').textContent = event.title;
            document.getElementById('rsvp-event-date').textContent = new Date(event.event_date).toLocaleDateString('pt-BR');
            
            if (event.description) {
                document.getElementById('rsvp-event-description').textContent = event.description;
            } else {
                document.getElementById('rsvp-event-description').style.display = 'none';
            }
            
            // Show deadline if set
            if (event.confirmation_deadline) {
                const deadlineDate = new Date(event.confirmation_deadline);
                document.getElementById('deadline-date').textContent = deadlineDate.toLocaleDateString('pt-BR');
                document.getElementById('deadline-notice').classList.remove('hidden');
            }
            
            // Setup companion section
            if (allowCompanion) {
                document.getElementById('companion-section').classList.remove('hidden');
                setupCompanionInputs();
            }
        }

        function setupCompanionInputs() {
            const container = document.getElementById('companion-inputs');
            container.innerHTML = `
                <input type="text" id="companion-1" class="w-full p-3 border rounded-lg mb-2" placeholder="Nome do acompanhante">
            `;
        }

        document.getElementById('rsvp-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const guestName = document.getElementById('guest-name').value;
            const attendance = document.getElementById('attendance-status').value === 'true';
            const message = document.getElementById('guest-message').value;
            
            let companionName = '';
            if (window.allowCompanion) {
                const companion1 = document.getElementById('companion-1').value.trim();
                if (companion1) {
                    companionName = companion1;
                }
            }
            
            const newRsvp = {
                id: generateId(),
                wedding_id: window.currentEventData.id,
                guest_name: guestName,
                companion_name: companionName,
                attendance: attendance,
                message: message,
                created_at: new Date().toISOString()
            };
            
            rsvps.push(newRsvp);
            saveData();
            
            // Show gift section if enabled
            if (window.currentEventData.enable_gifts && attendance) {
                showGiftSection();
            } else {
                showSuccessMessage();
            }
        });

        function showGiftSection() {
            document.getElementById('gift-section').classList.remove('hidden');
            
            const giftConfig = window.currentEventData.gift_config;
            if (giftConfig.type === 'bank') {
                document.getElementById('bank-gift-option').classList.remove('hidden');
                document.getElementById('bank-gift-message').textContent = giftConfig.message;
                document.getElementById('display-iban').value = giftConfig.iban;
            } else if (giftConfig.type === 'list') {
                document.getElementById('list-gift-option').classList.remove('hidden');
                loadAvailableGifts();
            }
        }

        function loadAvailableGifts() {
            const container = document.getElementById('available-gifts');
            const giftConfig = window.currentEventData.gift_config;
            
            if (!giftConfig.items) return;
            
            container.innerHTML = '';
            giftConfig.items.forEach((item, index) => {
                const selectedCount = gifts.filter(g => g.event_id === window.currentEventData.id && g.gift_name === item.name).length;
                const available = item.quantity - selectedCount;
                
                if (available > 0) {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50';
                    div.onclick = () => selectGift(item.name);
                    div.innerHTML = `
                        <span class="font-medium">${item.name}</span>
                        <span class="text-sm text-gray-500">${available} dispon√≠vel(is)</span>
                    `;
                    container.appendChild(div);
                }
            });
        }

        function selectGift(giftName) {
            const newGift = {
                id: generateId(),
                event_id: window.currentEventData.id,
                guest_name: document.getElementById('guest-name').value,
                gift_name: giftName,
                selection_type: 'list',
                created_at: new Date().toISOString()
            };
            
            gifts.push(newGift);
            saveData();
            
            showSuccessMessage();
        }

        function copyIban() {
            const input = document.getElementById('display-iban');
            input.select();
            document.execCommand('copy');
            
            const button = event.target;
            button.textContent = 'Copiado!';
            button.classList.add('bg-green-600');
            setTimeout(() => {
                button.textContent = 'Copiar IBAN';
                button.classList.remove('bg-green-600');
                button.classList.add('bg-purple-600');
            }, 2000);
        }

        function skipGifts() {
            showSuccessMessage();
        }

        function confirmGiftChoice() {
            const newGift = {
                id: generateId(),
                event_id: window.currentEventData.id,
                guest_name: document.getElementById('guest-name').value,
                gift_name: 'Transfer√™ncia Banc√°ria',
                selection_type: 'bank',
                created_at: new Date().toISOString()
            };
            
            gifts.push(newGift);
            saveData();
            
            showSuccessMessage();
        }

        function showSuccessMessage() {
            document.getElementById('gift-section').style.display = 'none';
            document.getElementById('success-message').classList.remove('hidden');
            
            // Show message wall if enabled
            if (window.currentEventData.enable_public_wall) {
                loadGuestMessageWall();
                document.getElementById('guest-message-wall').classList.remove('hidden');
            }
        }

        function loadGuestMessageWall() {
            const eventRsvps = rsvps.filter(r => r.wedding_id === window.currentEventData.id && r.message)
                .sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
            
            const container = document.getElementById('guest-messages-list');
            container.innerHTML = '';
            
            eventRsvps.forEach(rsvp => {
                const div = document.createElement('div');
                div.className = 'message-bubble p-3 rounded-lg';
                
                let guestInfo = rsvp.guest_name;
                if (rsvp.companion_name) {
                    guestInfo += ` e ${rsvp.companion_name}`;
                }
                
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-semibold text-sm text-purple-700">${guestInfo}</span>
                        <span class="text-xs text-gray-500">${new Date(rsvp.created_at).toLocaleDateString('pt-BR')}</span>
                    </div>
                    <p class="text-sm text-gray-700">${rsvp.message}</p>
                `;
                container.appendChild(div);
            });
        }

        // Initialize app
        window.addEventListener('load', function() {
            loadUserSession();
            
            // Check if this is a guest RSVP page
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('event')) {
                loadGuestRSVP();
            } else {
                showSection('home');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'972fa018e54177e0',t:'MTc1NTgzNjkyNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
