<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirma√ß√£o de Presen√ßa - Casamento</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap');
        
        .font-dancing { font-family: 'Dancing Script', cursive; }
        .font-inter { font-family: 'Inter', sans-serif; }
        
        .white-bg {
            background: white;
            min-height: 100vh;
        }
        
        .card-white {
            background: white;
            border: 1px solid #e5e7eb;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }
        
        .countdown-box {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 20px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .floating-hearts {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .heart {
            position: absolute;
            color: rgba(156, 163, 175, 0.4);
            font-size: 20px;
            animation: float 8s linear infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }
        
        .radio-option {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .radio-option:hover {
            transform: translateY(-2px);
        }
        
        .radio-option.selected {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
        }
    </style>
</head>
<body class="white-bg font-inter">
    <div class="floating-hearts" id="heartsContainer"></div>
    
    <div class="container mx-auto px-4 py-8 relative z-10">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="font-dancing text-6xl md:text-8xl text-gray-800 mb-4">
                Ana & Jo√£o
            </h1>
            <p class="text-gray-700 text-xl md:text-2xl font-light mb-6">
                Voc√™ est√° convidado para nosso casamento! üíï
            </p>
            
            <!-- Countdown Timer -->
            <div class="countdown-box max-w-2xl mx-auto">
                <h3 class="text-2xl font-semibold text-gray-800 mb-4">‚è∞ Contagem Regressiva</h3>
                <div class="grid grid-cols-4 gap-4 text-center">
                    <div>
                        <div id="days" class="text-3xl font-bold text-purple-600">00</div>
                        <div class="text-sm text-gray-600">Dias</div>
                    </div>
                    <div>
                        <div id="hours" class="text-3xl font-bold text-purple-600">00</div>
                        <div class="text-sm text-gray-600">Horas</div>
                    </div>
                    <div>
                        <div id="minutes" class="text-3xl font-bold text-purple-600">00</div>
                        <div class="text-sm text-gray-600">Minutos</div>
                    </div>
                    <div>
                        <div id="seconds" class="text-3xl font-bold text-purple-600">00</div>
                        <div class="text-sm text-gray-600">Segundos</div>
                    </div>
                </div>
                <p class="text-gray-700 mt-4">
                    üìÖ 15 de Junho de 2024 ‚Ä¢ üïï 17:00 ‚Ä¢ üìç Igreja S√£o Jos√©
                </p>
            </div>
        </div>

        <!-- Client Access Button - Top Right -->
        <div class="absolute top-4 right-4 z-20">
            <button id="clientAccessBtn" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-200 transition-all border border-gray-300 text-sm">
                üîê √Årea do Cliente
            </button>
        </div>

        <!-- Guest RSVP Section -->
        <div id="guestSection" class="max-w-2xl mx-auto">
            <div class="card-white rounded-3xl shadow-lg p-8 md:p-12">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-gradient-to-r from-pink-400 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-6">
                        <span class="text-3xl">üíå</span>
                    </div>
                    <h2 class="text-3xl font-semibold text-gray-800 mb-4">
                        Confirme sua Presen√ßa
                    </h2>
                    <p class="text-gray-600 mb-8">
                        Preencha os dados abaixo para confirmar sua presen√ßa em nosso grande dia
                    </p>
                </div>

                <form id="rsvpForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Seu Nome Completo *
                        </label>
                        <input 
                            type="text" 
                            id="guestName" 
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                            placeholder="Digite seu nome completo"
                        >
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-4">
                            Voc√™ confirmar√° presen√ßa? *
                        </label>
                        <div class="grid grid-cols-2 gap-4">
                            <label class="radio-option">
                                <input type="radio" name="attending" value="true" class="sr-only" required>
                                <div class="attendance-option border-2 border-gray-300 rounded-xl p-6 text-center transition-all">
                                    <div class="text-4xl mb-3">‚úÖ</div>
                                    <div class="font-semibold text-gray-700">Sim, estarei l√°!</div>
                                    <div class="text-sm text-gray-500 mt-1">Mal posso esperar!</div>
                                </div>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="attending" value="false" class="sr-only" required>
                                <div class="attendance-option border-2 border-gray-300 rounded-xl p-6 text-center transition-all">
                                    <div class="text-4xl mb-3">‚ùå</div>
                                    <div class="font-semibold text-gray-700">N√£o poderei ir</div>
                                    <div class="text-sm text-gray-500 mt-1">Infelizmente...</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div id="companionSection" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Quantos acompanhantes? (opcional)
                        </label>
                        <select 
                            id="guestCount" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                        >
                            <option value="0">Apenas eu</option>
                            <option value="1">Eu + 1 acompanhante</option>
                            <option value="2">Eu + 2 acompanhantes</option>
                            <option value="3">Eu + 3 acompanhantes</option>
                            <option value="4">Eu + 4 acompanhantes</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Mensagem Especial (opcional)
                        </label>
                        <textarea 
                            id="message" 
                            rows="4"
                            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all resize-none"
                            placeholder="Deixe uma mensagem carinhosa para os noivos..."
                        ></textarea>
                    </div>

                    <button 
                        type="submit" 
                        class="w-full btn-primary text-white font-semibold py-4 px-6 rounded-xl text-lg"
                    >
                        Enviar Confirma√ß√£o
                    </button>
                </form>
            </div>
        </div>

        <!-- Client Login Section -->
        <div id="clientLoginSection" class="max-w-md mx-auto hidden">
            <div class="card-white rounded-3xl shadow-lg p-8">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-6">
                        <span class="text-3xl">üîê</span>
                    </div>
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">
                        √Årea do Cliente
                    </h2>
                    <p class="text-gray-600 mb-6">
                        Digite seu token de acesso para ver as confirma√ß√µes
                    </p>
                </div>

                <form id="clientLoginForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Token de Acesso
                        </label>
                        <input 
                            type="text" 
                            id="clientToken" 
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="Digite seu token"
                        >
                    </div>

                    <button 
                        type="submit" 
                        class="w-full btn-primary text-white font-semibold py-3 px-6 rounded-xl"
                    >
                        Acessar Dashboard
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <button id="backToGuestBtn" class="text-gray-500 hover:text-gray-700 font-medium">
                        ‚Üê Voltar para confirma√ß√£o
                    </button>
                </div>
            </div>
        </div>

        <!-- Client Dashboard Section -->
        <div id="clientDashboard" class="max-w-6xl mx-auto hidden">
            <div class="card-white rounded-3xl shadow-lg p-8">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <h2 class="text-3xl font-semibold text-gray-800">Dashboard do Cliente</h2>
                        <p class="text-gray-600">Gerencie as confirma√ß√µes do seu evento</p>
                    </div>
                    <div class="flex gap-4">
                        <button id="exportPdfBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-all">
                            üìÑ Exportar PDF
                        </button>
                        <button id="logoutBtn" class="text-gray-500 hover:text-gray-700 font-medium">
                            Sair
                        </button>
                    </div>
                </div>

                <!-- Client Tools -->
                <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-2xl p-6 mb-8">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">üõ†Ô∏è Ferramentas Exclusivas do Cliente</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <button id="sendRemindersBtn" class="bg-white hover:bg-gray-50 border border-gray-200 rounded-lg p-4 text-center transition-all">
                            <div class="text-2xl mb-2">üìß</div>
                            <div class="text-sm font-medium text-gray-700">Enviar Lembretes</div>
                        </button>
                        <button id="editEventBtn" class="bg-white hover:bg-gray-50 border border-gray-200 rounded-lg p-4 text-center transition-all">
                            <div class="text-2xl mb-2">‚úèÔ∏è</div>
                            <div class="text-sm font-medium text-gray-700">Editar Evento</div>
                        </button>
                        <button id="guestAnalyticsBtn" class="bg-white hover:bg-gray-50 border border-gray-200 rounded-lg p-4 text-center transition-all">
                            <div class="text-2xl mb-2">üìä</div>
                            <div class="text-sm font-medium text-gray-700">An√°lises</div>
                        </button>
                        <button id="shareEventBtn" class="bg-white hover:bg-gray-50 border border-gray-200 rounded-lg p-4 text-center transition-all">
                            <div class="text-2xl mb-2">üîó</div>
                            <div class="text-sm font-medium text-gray-700">Compartilhar</div>
                        </button>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="stats-card">
                        <div class="text-3xl mb-2">‚úÖ</div>
                        <div class="text-2xl font-bold" id="confirmedCount">0</div>
                        <div class="text-sm opacity-90">Confirmados</div>
                    </div>
                    <div class="stats-card">
                        <div class="text-3xl mb-2">‚ùå</div>
                        <div class="text-2xl font-bold" id="declinedCount">0</div>
                        <div class="text-sm opacity-90">Recusaram</div>
                    </div>
                    <div class="stats-card">
                        <div class="text-3xl mb-2">üë•</div>
                        <div class="text-2xl font-bold" id="totalGuests">0</div>
                        <div class="text-sm opacity-90">Total de Pessoas</div>
                    </div>
                </div>

                <!-- Guest List -->
                <div class="bg-white rounded-2xl p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-gray-800">Lista de Convidados</h3>
                        <div class="flex gap-4">
                            <select id="statusFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                <option value="all">Todos</option>
                                <option value="confirmed">Confirmados</option>
                                <option value="declined">Recusaram</option>
                                <option value="with-companion">Com Acompanhante</option>
                            </select>
                            <input 
                                type="text" 
                                id="searchGuests" 
                                placeholder="Buscar convidado..."
                                class="border border-gray-300 rounded-lg px-3 py-2 text-sm w-48"
                            >
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-200">
                                    <th class="text-left py-3 px-4 font-medium text-gray-700">Nome</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-700">Acompanhante</th>
                                    <th class="text-center py-3 px-4 font-medium text-gray-700">Status</th>
                                    <th class="text-left py-3 px-4 font-medium text-gray-700">Mensagem</th>
                                    <th class="text-center py-3 px-4 font-medium text-gray-700">Data</th>
                                    <th class="text-center py-3 px-4 font-medium text-gray-700">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="guestList">
                                <!-- Guest list will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="max-w-2xl mx-auto hidden">
            <div class="card-white rounded-3xl shadow-lg p-8 text-center">
                <div class="w-24 h-24 bg-gradient-to-r from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
                    <span class="text-4xl">üéâ</span>
                </div>
                <h2 class="text-3xl font-semibold text-gray-800 mb-4">
                    Confirma√ß√£o Enviada!
                </h2>
                <p class="text-gray-600 mb-8">
                    Obrigado por confirmar sua presen√ßa. Mal podemos esperar para celebrar com voc√™!
                </p>
                <button 
                    id="newRsvpBtn"
                    class="btn-primary text-white font-semibold py-3 px-6 rounded-xl"
                >
                    Nova Confirma√ß√£o
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Event Modal -->
    <div id="editEventModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-r from-purple-400 to-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-2xl">‚úèÔ∏è</span>
                </div>
                <h3 class="text-2xl font-semibold text-gray-800">Editar Evento</h3>
                <p class="text-gray-600 mt-2">Atualize as informa√ß√µes do seu casamento</p>
            </div>

            <form id="editEventForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Nome do Casal *
                    </label>
                    <input 
                        type="text" 
                        id="editCoupleName" 
                        required
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                        placeholder="Ex: Ana & Jo√£o"
                    >
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Nome da Noiva
                    </label>
                    <input 
                        type="text" 
                        id="editBrideName" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                        placeholder="Nome da noiva"
                    >
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Nome do Noivo
                    </label>
                    <input 
                        type="text" 
                        id="editGroomName" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                        placeholder="Nome do noivo"
                    >
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Data do Evento *
                    </label>
                    <input 
                        type="date" 
                        id="editEventDate" 
                        required
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                    >
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Hor√°rio do Evento
                    </label>
                    <input 
                        type="time" 
                        id="editEventTime" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                    >
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Local do Evento
                    </label>
                    <input 
                        type="text" 
                        id="editEventLocation" 
                        class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                        placeholder="Ex: Igreja S√£o Jos√©"
                    >
                </div>

                <div class="flex gap-4 pt-4">
                    <button 
                        type="button" 
                        id="cancelEditBtn"
                        class="flex-1 bg-gray-100 text-gray-700 font-semibold py-3 px-6 rounded-xl hover:bg-gray-200 transition-all"
                    >
                        Cancelar
                    </button>
                    <button 
                        type="submit" 
                        class="flex-1 btn-primary text-white font-semibold py-3 px-6 rounded-xl"
                    >
                        Salvar Altera√ß√µes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"></div>
            <p class="text-gray-600">Processando...</p>
        </div>
    </div>

    <script>
        // üóÑÔ∏è CONFIGURA√á√ÉO DO SUPABASE
        // Este sistema funciona 100% integrado com Supabase:
        // 1. Dados dos clientes ficam na tabela 'wedding_clients'
        // 2. Confirma√ß√µes dos convidados ficam na tabela 'wedding_confirmations'
        // 3. Cada cliente tem um client_id √∫nico gerado pelo painel administrativo
        // 4. O painel gera links √∫nicos no formato: /c/client-id
        const supabaseUrl = 'https://qlbpqpxhswyicxyffhws.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFsYnBxcHhoc3d5aWN4eWZmaHdzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NDczMzYyMiwiZXhwIjoyMDcwMzA5NjIyfQ.YOUR_SERVICE_ROLE_KEY_HERE';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // üîó EXTRA√á√ÉO DO CLIENT_ID DA URL
        // O painel administrativo gera links √∫nicos no formato:
        // https://seudominio.com/c/client-id-unico
        // Exemplo: https://araujo418.github.io/painel-invitesqr/c/ana-joao-2024
        function getClientIdFromURL() {
            const pathname = window.location.pathname;
            console.log('üîç Analisando URL:', pathname);
            
            // Padr√£o principal: /c/client-id ou /qualquer-path/c/client-id
            const match = pathname.match(/\/c\/([^\/]+)/);
            if (match) {
                console.log('‚úÖ Client ID encontrado na URL:', match[1]);
                return match[1];
            }
            
            // Fallback para par√¢metro de query (?client=client-id)
            const urlParams = new URLSearchParams(window.location.search);
            const clientParam = urlParams.get('client');
            if (clientParam) {
                console.log('‚úÖ Client ID encontrado no par√¢metro:', clientParam);
                return clientParam;
            }
            
            // ‚ö†Ô∏è ATEN√á√ÉO: Este fallback √© apenas para demonstra√ß√£o
            // Em produ√ß√£o, deve retornar erro se n√£o encontrar client_id
            console.warn('‚ö†Ô∏è Client ID n√£o encontrado, usando fallback de demonstra√ß√£o');
            return 'ana-joao-2024';
        }

        const CLIENT_ID = getClientIdFromURL();

        // üìä ESTRUTURA DAS TABELAS SUPABASE
        // 
        // Tabela: wedding_clients
        // - id (uuid, primary key)
        // - client_id (text, unique) - ID √∫nico gerado pelo painel
        // - couple_name (text) - Nome do casal (ex: "Ana & Jo√£o")
        // - bride_name (text) - Nome da noiva
        // - groom_name (text) - Nome do noivo
        // - event_date (date) - Data do casamento
        // - event_time (time) - Hor√°rio do casamento
        // - event_location (text) - Local do evento
        // - access_token (text) - Token para acesso do cliente
        // - status (text) - 'active' ou 'inactive'
        // - created_at (timestamp)
        // - updated_at (timestamp)
        //
        // Tabela: wedding_confirmations
        // - id (uuid, primary key)
        // - client_id (text) - Refer√™ncia ao cliente
        // - guest_name (text) - Nome do convidado
        // - will_attend (boolean) - Confirmou presen√ßa?
        // - guest_count (integer) - N√∫mero de acompanhantes
        // - dietary_restrictions (text) - Restri√ß√µes alimentares
        // - message (text) - Mensagem do convidado
        // - created_at (timestamp)

        // Data do evento ser√° carregada dinamicamente do Supabase
        let eventDate = new Date('2024-06-15T17:00:00').getTime(); // Fallback inicial

        // Elementos DOM
        const guestSection = document.getElementById('guestSection');
        const clientLoginSection = document.getElementById('clientLoginSection');
        const clientDashboard = document.getElementById('clientDashboard');
        const successMessage = document.getElementById('successMessage');
        const loadingOverlay = document.getElementById('loadingOverlay');

        // Estado da aplica√ß√£o
        let currentClientId = null;
        let currentClientData = null;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', async () => {
            setupEventListeners();
            startCountdown();
            createFloatingHearts();
            checkStoredClientToken();
            await loadClientInfo();
            await loadGuestMessages();
        });

        // Carregar informa√ß√µes do cliente espec√≠fico do Supabase
        async function loadClientInfo() {
            try {
                showLoading(true);
                
                // Buscar dados do cliente espec√≠fico na tabela wedding_clients
                const { data: clientData, error: clientError } = await supabase
                    .from('wedding_clients')
                    .select('*')
                    .eq('client_id', CLIENT_ID)
                    .eq('status', 'active')
                    .single();

                if (clientError) {
                    console.error('Cliente n√£o encontrado:', clientError);
                    
                    // Mostrar p√°gina de erro personalizada
                    document.body.innerHTML = `
                        <div class="min-h-screen flex items-center justify-center bg-gray-50">
                            <div class="text-center p-8">
                                <div class="text-6xl mb-4">üòî</div>
                                <h1 class="text-2xl font-bold text-gray-800 mb-4">Evento n√£o encontrado</h1>
                                <p class="text-gray-600 mb-6">O link que voc√™ acessou n√£o √© v√°lido ou o evento foi removido.</p>
                                <p class="text-sm text-gray-500">Verifique o link com quem te enviou o convite.</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                // Armazenar dados do cliente globalmente
                currentClientData = clientData;
                
                // Atualizar interface com dados do cliente
                updateClientInterface(clientData);
                
                console.log('‚úÖ Cliente carregado:', clientData.couple_name);
                
            } catch (error) {
                console.error('Erro ao carregar cliente:', error);
                showNotification('Erro ao carregar dados do evento.', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Atualizar interface com dados espec√≠ficos do cliente vindos do Supabase
        function updateClientInterface(clientData) {
            console.log('üîÑ Atualizando interface com dados:', clientData);
            
            // Atualizar nomes dos noivos no t√≠tulo principal
            const coupleNames = document.querySelector('.font-dancing');
            if (coupleNames && clientData.couple_name) {
                coupleNames.textContent = clientData.couple_name;
                console.log('‚úÖ Nome do casal atualizado:', clientData.couple_name);
            }

            // Atualizar subt√≠tulo personalizado
            const subtitle = document.querySelector('.text-xl.md\\:text-2xl');
            if (subtitle && clientData.couple_name) {
                subtitle.innerHTML = `Voc√™ est√° convidado para nosso casamento! üíï`;
            }

            // Atualizar data, hor√°rio e local do evento
            if (clientData.event_date) {
                const eventDateElement = document.querySelector('.countdown-box p');
                const eventDateTime = new Date(clientData.event_date);
                
                // Se tiver hor√°rio separado, combinar
                if (clientData.event_time) {
                    const [hours, minutes] = clientData.event_time.split(':');
                    eventDateTime.setHours(parseInt(hours), parseInt(minutes));
                }
                
                const formattedDate = eventDateTime.toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: 'long',
                    year: 'numeric'
                });
                
                const formattedTime = clientData.event_time || eventDateTime.toLocaleTimeString('pt-BR', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const location = clientData.event_location || 'Local a definir';
                
                if (eventDateElement) {
                    eventDateElement.innerHTML = `üìÖ ${formattedDate} ‚Ä¢ üïï ${formattedTime} ‚Ä¢ üìç ${location}`;
                    console.log('‚úÖ Data/hora/local atualizados:', formattedDate, formattedTime, location);
                }
                
                // Atualizar contador regressivo global
                eventDate = eventDateTime.getTime();
                console.log('‚úÖ Contador regressivo atualizado para:', new Date(eventDate));
            }

            // Atualizar t√≠tulo da p√°gina dinamicamente
            const pageTitle = `Confirma√ß√£o de Presen√ßa - ${clientData.couple_name || 'Casamento'}`;
            document.title = pageTitle;
            console.log('‚úÖ T√≠tulo da p√°gina atualizado:', pageTitle);

            // Atualizar mensagem de confirma√ß√£o personalizada
            const confirmationTitle = document.querySelector('#guestSection h2');
            if (confirmationTitle) {
                confirmationTitle.textContent = 'Confirme sua Presen√ßa';
            }

            const confirmationSubtitle = document.querySelector('#guestSection p');
            if (confirmationSubtitle) {
                confirmationSubtitle.textContent = 'Preencha os dados abaixo para confirmar sua presen√ßa em nosso grande dia';
            }
        }

        // Verificar token armazenado
        function checkStoredClientToken() {
            const storedToken = localStorage.getItem(`clientToken_${CLIENT_ID}`);
            if (storedToken) {
                document.getElementById('clientToken').value = storedToken;
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Navega√ß√£o
            document.getElementById('clientAccessBtn').addEventListener('click', showClientLogin);
            document.getElementById('backToGuestBtn').addEventListener('click', showGuestSection);
            document.getElementById('logoutBtn').addEventListener('click', logoutClient);
            document.getElementById('newRsvpBtn').addEventListener('click', showGuestSection);

            // Client tools
            document.getElementById('exportPdfBtn').addEventListener('click', exportToPDF);
            document.getElementById('sendRemindersBtn').addEventListener('click', sendReminders);
            document.getElementById('editEventBtn').addEventListener('click', editEvent);
            document.getElementById('guestAnalyticsBtn').addEventListener('click', showAnalytics);
            document.getElementById('shareEventBtn').addEventListener('click', shareEvent);

            // Filters and search
            document.getElementById('statusFilter').addEventListener('change', filterGuests);
            document.getElementById('searchGuests').addEventListener('input', filterGuests);

            // Formul√°rios
            document.getElementById('rsvpForm').addEventListener('submit', handleGuestRSVP);
            document.getElementById('clientLoginForm').addEventListener('submit', handleClientLogin);
            document.getElementById('editEventForm').addEventListener('submit', handleEditEvent);
            
            // Modal controls
            document.getElementById('cancelEditBtn').addEventListener('click', closeEditModal);

            // Op√ß√µes de presen√ßa
            document.querySelectorAll('input[name="attending"]').forEach(radio => {
                radio.addEventListener('change', handleAttendingChange);
            });
        }

        // Manipular mudan√ßa na op√ß√£o de presen√ßa
        function handleAttendingChange(e) {
            // Atualizar visual das op√ß√µes
            document.querySelectorAll('.attendance-option').forEach(option => {
                option.classList.remove('border-green-400', 'bg-green-50', 'border-red-400', 'bg-red-50', 'selected');
                option.classList.add('border-gray-300');
            });

            const selectedOption = e.target.closest('label').querySelector('.attendance-option');
            const radioOption = e.target.closest('.radio-option');
            
            if (e.target.value === 'true') {
                selectedOption.classList.add('border-green-400', 'bg-green-50', 'selected');
                radioOption.classList.add('selected');
                document.getElementById('companionSection').classList.remove('hidden');
            } else {
                selectedOption.classList.add('border-red-400', 'bg-red-50', 'selected');
                radioOption.classList.add('selected');
                document.getElementById('companionSection').classList.add('hidden');
                document.getElementById('guestCount').value = '0';
            }
        }

        // Carregar recados dos convidados
        async function loadGuestMessages() {
            try {
                // Buscar apenas confirma√ß√µes com mensagens deste cliente espec√≠fico
                const { data, error } = await supabase
                    .from('wedding_confirmations')
                    .select('guest_name, message, created_at, will_attend')
                    .eq('client_id', CLIENT_ID)
                    .not('message', 'is', null)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                updateMessagesDisplay(data);
            } catch (error) {
                console.error('Erro ao carregar recados:', error);
            }
        }

        // Atualizar exibi√ß√£o dos recados
        function updateMessagesDisplay(messages) {
            const messagesContainer = document.getElementById('messagesContainer');
            
            if (!messages || messages.length === 0) {
                messagesContainer.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-4">üíå</div>
                        <p>Ainda n√£o h√° recados dos convidados</p>
                        <p class="text-sm mt-2">Seja o primeiro a deixar uma mensagem carinhosa!</p>
                    </div>
                `;
                return;
            }

            messagesContainer.innerHTML = messages.map(msg => {
                const date = new Date(msg.created_at).toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const statusIcon = msg.will_attend ? '‚úÖ' : '‚ùå';
                const statusText = msg.will_attend ? 'Confirmou presen√ßa' : 'N√£o poder√° comparecer';

                return `
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 border border-purple-100">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center gap-2">
                                <span class="font-semibold text-gray-800">${msg.guest_name}</span>
                                <span class="text-xs px-2 py-1 rounded-full ${msg.will_attend ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                                    ${statusIcon} ${statusText}
                                </span>
                            </div>
                            <span class="text-xs text-gray-500">${date}</span>
                        </div>
                        <p class="text-gray-700 italic leading-relaxed">"${msg.message}"</p>
                    </div>
                `;
            }).join('');
        }

        // Manipular confirma√ß√£o do convidado
        async function handleGuestRSVP(e) {
            e.preventDefault();
            showLoading(true);

            const formData = new FormData(e.target);
            const guestName = document.getElementById('guestName').value.trim();
            const attending = formData.get('attending') === 'true';
            const guestCount = parseInt(document.getElementById('guestCount').value) || 0;
            const message = document.getElementById('message').value.trim();

            try {

                // Usar o CLIENT_ID espec√≠fico da URL e estrutura correta
                const confirmationData = {
                    client_id: CLIENT_ID,
                    guest_name: guestName,
                    will_attend: attending,
                    guest_count: guestCount,
                    dietary_restrictions: null, // Pode ser adicionado depois
                    message: message || null,
                    created_at: new Date().toISOString()
                };

                const { error } = await supabase
                    .from('wedding_confirmations')
                    .insert([confirmationData]);

                if (error) throw error;

                // Recarregar recados se uma mensagem foi adicionada
                if (message) {
                    await loadGuestMessages();
                }

                showSuccessMessage();
                showNotification('Confirma√ß√£o enviada com sucesso! üéâ', 'success');
            } catch (error) {
                console.error('Erro ao enviar RSVP:', error);
                showNotification('Erro ao enviar confirma√ß√£o. Tente novamente.', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Manipular login do cliente
        async function handleClientLogin(e) {
            e.preventDefault();
            showLoading(true);

            const token = document.getElementById('clientToken').value.trim();

            try {
                // Verificar se o token existe para este cliente espec√≠fico
                const { data, error } = await supabase
                    .from('wedding_clients')
                    .select('*')
                    .eq('access_token', token)
                    .eq('client_id', CLIENT_ID)
                    .eq('status', 'active')
                    .single();

                if (error || !data) {
                    throw new Error('Token inv√°lido para este evento');
                }

                currentClientId = data.client_id;
                localStorage.setItem(`clientToken_${CLIENT_ID}`, token);
                
                await loadClientDashboard();
                showNotification('Login realizado com sucesso! üéâ', 'success');
            } catch (error) {
                console.error('Erro no login:', error);
                showNotification('Token inv√°lido. Verifique e tente novamente.', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Carregar dashboard do cliente
        async function loadClientDashboard() {
            try {
                // Buscar apenas confirma√ß√µes deste cliente espec√≠fico com ID
                const { data, error } = await supabase
                    .from('wedding_confirmations')
                    .select('id, client_id, guest_name, will_attend, guest_count, message, created_at')
                    .eq('client_id', CLIENT_ID)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                updateDashboardStats(data);
                updateGuestList(data);
                showClientDashboard();
            } catch (error) {
                console.error('Erro ao carregar dashboard:', error);
                showNotification('Erro ao carregar dados do dashboard.', 'error');
            }
        }

        // Atualizar estat√≠sticas do dashboard
        function updateDashboardStats(confirmations) {
            const confirmed = confirmations.filter(conf => conf.will_attend).length;
            const declined = confirmations.filter(conf => !conf.will_attend).length;
            const totalPeople = confirmations.reduce((total, conf) => {
                if (conf.will_attend) {
                    return total + 1 + (conf.guest_count || 0);
                }
                return total;
            }, 0);

            document.getElementById('confirmedCount').textContent = confirmed;
            document.getElementById('declinedCount').textContent = declined;
            document.getElementById('totalGuests').textContent = totalPeople;
        }

        // Atualizar lista de convidados
        function updateGuestList(confirmations) {
            // Store data for filtering
            allGuestData = confirmations;
            
            const guestList = document.getElementById('guestList');
            guestList.innerHTML = '';

            if (confirmations.length === 0) {
                guestList.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-8 text-gray-500">
                            Nenhuma confirma√ß√£o ainda
                        </td>
                    </tr>
                `;
                return;
            }

            confirmations.forEach(conf => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100 hover:bg-gray-50';
                
                const statusBadge = conf.will_attend 
                    ? '<span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium">‚úÖ Confirmado</span>'
                    : '<span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs font-medium">‚ùå Recusou</span>';

                const companionText = conf.guest_count > 0
                    ? `<span class="text-gray-600">+ ${conf.guest_count} acompanhante${conf.guest_count > 1 ? 's' : ''}</span>`
                    : '<span class="text-gray-400">-</span>';

                const messageText = conf.message 
                    ? `<span class="text-gray-600">${conf.message}</span>`
                    : '<span class="text-gray-400">-</span>';

                const date = new Date(conf.created_at).toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                row.innerHTML = `
                    <td class="py-3 px-4 font-medium text-gray-900">${conf.guest_name}</td>
                    <td class="py-3 px-4">${companionText}</td>
                    <td class="py-3 px-4 text-center">${statusBadge}</td>
                    <td class="py-3 px-4 max-w-xs truncate">${messageText}</td>
                    <td class="py-3 px-4 text-center text-sm text-gray-500">${date}</td>
                    <td class="py-3 px-4 text-center">
                        <button 
                            onclick="removeGuest('${conf.id}', '${conf.guest_name}')"
                            class="text-red-500 hover:text-red-700 hover:bg-red-50 p-2 rounded-lg transition-all"
                            title="Remover confirma√ß√£o"
                        >
                            üóëÔ∏è
                        </button>
                    </td>
                `;

                guestList.appendChild(row);
            });
        }

        // Remover convidado
        async function removeGuest(guestId, guestName) {
            if (!confirm(`Tem certeza que deseja remover a confirma√ß√£o de "${guestName}"?\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) {
                return;
            }

            showLoading(true);

            try {
                const { error } = await supabase
                    .from('wedding_confirmations')
                    .delete()
                    .eq('id', guestId)
                    .eq('client_id', CLIENT_ID); // Seguran√ßa extra

                if (error) throw error;

                // Recarregar dashboard
                await loadClientDashboard();
                
                // Recarregar recados se necess√°rio
                await loadGuestMessages();

                showNotification(`Confirma√ß√£o de "${guestName}" removida com sucesso! üóëÔ∏è`, 'success');
            } catch (error) {
                console.error('Erro ao remover convidado:', error);
                showNotification('Erro ao remover confirma√ß√£o. Tente novamente.', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Fun√ß√µes de navega√ß√£o
        function showGuestSection() {
            guestSection.classList.remove('hidden');
            document.getElementById('guestMessagesSection').classList.remove('hidden');
            clientLoginSection.classList.add('hidden');
            clientDashboard.classList.add('hidden');
            successMessage.classList.add('hidden');
            
            // Limpar formul√°rio
            document.getElementById('rsvpForm').reset();
            document.getElementById('companionSection').classList.add('hidden');
            document.getElementById('guestCount').value = '0';
            
            // Resetar op√ß√µes visuais
            document.querySelectorAll('.attendance-option').forEach(option => {
                option.classList.remove('border-green-400', 'bg-green-50', 'border-red-400', 'bg-red-50', 'selected');
                option.classList.add('border-gray-300');
            });
            document.querySelectorAll('.radio-option').forEach(option => {
                option.classList.remove('selected');
            });
        }

        function showClientLogin() {
            guestSection.classList.add('hidden');
            document.getElementById('guestMessagesSection').classList.add('hidden');
            clientLoginSection.classList.remove('hidden');
            clientDashboard.classList.add('hidden');
            successMessage.classList.add('hidden');
        }

        function showClientDashboard() {
            guestSection.classList.add('hidden');
            document.getElementById('guestMessagesSection').classList.add('hidden');
            clientLoginSection.classList.add('hidden');
            clientDashboard.classList.remove('hidden');
            successMessage.classList.add('hidden');
        }

        function showSuccessMessage() {
            guestSection.classList.add('hidden');
            document.getElementById('guestMessagesSection').classList.add('hidden');
            clientLoginSection.classList.add('hidden');
            clientDashboard.classList.add('hidden');
            successMessage.classList.remove('hidden');
        }

        function logoutClient() {
            currentClientId = null;
            localStorage.removeItem(`clientToken_${CLIENT_ID}`);
            document.getElementById('clientLoginForm').reset();
            showGuestSection();
            showNotification('Logout realizado com sucesso!', 'success');
        }

        // Contador regressivo
        function startCountdown() {
            function updateCountdown() {
                const now = new Date().getTime();
                const distance = eventDate - now;

                if (distance < 0) {
                    document.getElementById('days').textContent = '00';
                    document.getElementById('hours').textContent = '00';
                    document.getElementById('minutes').textContent = '00';
                    document.getElementById('seconds').textContent = '00';
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                document.getElementById('days').textContent = days.toString().padStart(2, '0');
                document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
            }

            updateCountdown();
            setInterval(updateCountdown, 1000);
        }

        // Criar cora√ß√µes flutuantes
        function createFloatingHearts() {
            const heartsContainer = document.getElementById('heartsContainer');
            
            function createHeart() {
                const heart = document.createElement('div');
                heart.className = 'heart';
                heart.innerHTML = ['üíï', 'üíñ', 'üíó', 'üíù'][Math.floor(Math.random() * 4)];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDelay = Math.random() * 8 + 's';
                heart.style.animationDuration = (Math.random() * 3 + 8) + 's';
                
                heartsContainer.appendChild(heart);
                
                setTimeout(() => {
                    if (heartsContainer.contains(heart)) {
                        heartsContainer.removeChild(heart);
                    }
                }, 11000);
            }
            
            setInterval(createHeart, 3000);
            
            // Criar alguns cora√ß√µes iniciais
            for (let i = 0; i < 3; i++) {
                setTimeout(createHeart, i * 1000);
            }
        }

        // Client Tools Functions
        function exportToPDF() {
            showLoading(true);
            
            // Get current guest data
            const guestData = Array.from(document.querySelectorAll('#guestList tr')).map(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length === 0) return null;
                
                return {
                    name: cells[0]?.textContent?.trim() || '',
                    companion: cells[1]?.textContent?.trim() || '',
                    status: cells[2]?.textContent?.trim() || '',
                    message: cells[3]?.textContent?.trim() || '',
                    date: cells[4]?.textContent?.trim() || ''
                };
            }).filter(Boolean);

            // Create PDF content
            const pdfContent = generatePDFContent(guestData);
            
            // Create and download PDF
            const blob = new Blob([pdfContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'lista-convidados-casamento.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showLoading(false);
            showNotification('Lista exportada com sucesso! üìÑ', 'success');
        }

        function generatePDFContent(guestData) {
            const confirmedCount = guestData.filter(g => g.status.includes('Confirmado')).length;
            const declinedCount = guestData.filter(g => g.status.includes('Recusou')).length;
            const totalPeople = guestData.reduce((total, guest) => {
                if (guest.status.includes('Confirmado')) {
                    return total + 1 + (guest.companion && guest.companion !== '-' ? 1 : 0);
                }
                return total;
            }, 0);

            return `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Lista de Convidados - Casamento Ana & Jo√£o</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .stats { display: flex; justify-content: space-around; margin-bottom: 30px; }
        .stat-box { text-align: center; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f5f5f5; }
        .confirmed { color: green; }
        .declined { color: red; }
        .footer { margin-top: 30px; text-align: center; color: #666; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Lista de Convidados</h1>
        <h2>Casamento Ana & Jo√£o</h2>
        <p>15 de Junho de 2024 ‚Ä¢ 17:00 ‚Ä¢ Igreja S√£o Jos√©</p>
        <p>Relat√≥rio gerado em: ${new Date().toLocaleDateString('pt-BR')}</p>
    </div>
    
    <div class="stats">
        <div class="stat-box">
            <h3>${confirmedCount}</h3>
            <p>Confirmados</p>
        </div>
        <div class="stat-box">
            <h3>${declinedCount}</h3>
            <p>Recusaram</p>
        </div>
        <div class="stat-box">
            <h3>${totalPeople}</h3>
            <p>Total de Pessoas</p>
        </div>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Nome</th>
                <th>Acompanhante</th>
                <th>Status</th>
                <th>Mensagem</th>
                <th>Data</th>
            </tr>
        </thead>
        <tbody>
            ${guestData.map(guest => `
                <tr>
                    <td>${guest.name}</td>
                    <td>${guest.companion}</td>
                    <td class="${guest.status.includes('Confirmado') ? 'confirmed' : 'declined'}">${guest.status}</td>
                    <td>${guest.message}</td>
                    <td>${guest.date}</td>
                </tr>
            `).join('')}
        </tbody>
    </table>
    
    <div class="footer">
        <p>Sistema de Confirma√ß√£o de Presen√ßa - Casamento Ana & Jo√£o</p>
    </div>
</body>
</html>`;
        }

        function sendReminders() {
            showNotification('Funcionalidade de lembretes ser√° implementada em breve! üìß', 'info');
        }

        function editEvent() {
            if (!currentClientData) {
                showNotification('Erro: Dados do cliente n√£o encontrados.', 'error');
                return;
            }
            
            // Preencher formul√°rio com dados atuais
            document.getElementById('editCoupleName').value = currentClientData.couple_name || '';
            document.getElementById('editBrideName').value = currentClientData.bride_name || '';
            document.getElementById('editGroomName').value = currentClientData.groom_name || '';
            document.getElementById('editEventDate').value = currentClientData.event_date || '';
            document.getElementById('editEventTime').value = currentClientData.event_time || '';
            document.getElementById('editEventLocation').value = currentClientData.event_location || '';
            
            // Mostrar modal
            document.getElementById('editEventModal').classList.remove('hidden');
        }
        
        function closeEditModal() {
            document.getElementById('editEventModal').classList.add('hidden');
        }
        
        // Fechar modal ao clicar fora
        document.getElementById('editEventModal').addEventListener('click', (e) => {
            if (e.target.id === 'editEventModal') {
                closeEditModal();
            }
        });
        
        // Manipular edi√ß√£o do evento
        async function handleEditEvent(e) {
            e.preventDefault();
            showLoading(true);

            const formData = new FormData(e.target);
            const updatedData = {
                couple_name: document.getElementById('editCoupleName').value.trim(),
                bride_name: document.getElementById('editBrideName').value.trim(),
                groom_name: document.getElementById('editGroomName').value.trim(),
                event_date: document.getElementById('editEventDate').value,
                event_time: document.getElementById('editEventTime').value,
                event_location: document.getElementById('editEventLocation').value.trim(),
                updated_at: new Date().toISOString()
            };

            try {
                // Atualizar no Supabase
                const { error } = await supabase
                    .from('wedding_clients')
                    .update(updatedData)
                    .eq('client_id', CLIENT_ID);

                if (error) throw error;

                // Atualizar dados locais
                currentClientData = { ...currentClientData, ...updatedData };
                
                // Atualizar interface
                updateClientInterface(currentClientData);
                
                // Fechar modal
                closeEditModal();
                
                showNotification('Evento atualizado com sucesso! üéâ', 'success');
            } catch (error) {
                console.error('Erro ao atualizar evento:', error);
                showNotification('Erro ao atualizar evento. Tente novamente.', 'error');
            } finally {
                showLoading(false);
            }
        }

        function showAnalytics() {
            showNotification('An√°lises detalhadas ser√£o implementadas em breve! üìä', 'info');
        }

        function shareEvent() {
            const url = window.location.href;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(url).then(() => {
                    showNotification('Link copiado para a √°rea de transfer√™ncia! üîó', 'success');
                });
            } else {
                showNotification('Link: ' + url, 'info');
            }
        }

        // Filter and search functionality
        let allGuestData = [];

        function filterGuests() {
            const statusFilter = document.getElementById('statusFilter').value;
            const searchTerm = document.getElementById('searchGuests').value.toLowerCase();
            
            let filteredData = allGuestData;

            // Apply status filter
            if (statusFilter !== 'all') {
                filteredData = filteredData.filter(conf => {
                    switch (statusFilter) {
                        case 'confirmed':
                            return conf.will_attend;
                        case 'declined':
                            return !conf.will_attend;
                        case 'with-companion':
                            return conf.guest_count > 0;
                        default:
                            return true;
                    }
                });
            }

            // Apply search filter
            if (searchTerm) {
                filteredData = filteredData.filter(conf => 
                    conf.guest_name.toLowerCase().includes(searchTerm) ||
                    (conf.message && conf.message.toLowerCase().includes(searchTerm))
                );
            }

            updateGuestList(filteredData);
        }

        // Fun√ß√µes utilit√°rias
        function showLoading(show) {
            if (show) {
                loadingOverlay.classList.remove('hidden');
            } else {
                loadingOverlay.classList.add('hidden');
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 translate-x-full`;
            
            if (type === 'success') {
                notification.classList.add('bg-green-500', 'text-white');
            } else if (type === 'error') {
                notification.classList.add('bg-red-500', 'text-white');
            } else {
                notification.classList.add('bg-blue-500', 'text-white');
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c77af1c29777e0',t:'MTc1NDc0NDg4Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
